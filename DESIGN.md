# ç”»å¸ƒç¼–è¾‘å™¨æŠ€æœ¯è®¾è®¡æ–‡æ¡£

## 1. éœ€æ±‚ä¿¡æ¯

### éœ€æ±‚æ¦‚è¿°
å¼€å‘ä¸€ä¸ªç±»ä¼¼ Figma/Canva çš„åœ¨çº¿ç”»å¸ƒç¼–è¾‘å™¨ï¼Œæ”¯æŒå›¾å½¢ç»˜åˆ¶ã€æ–‡æœ¬ç¼–è¾‘ã€å›¾ç‰‡å¤„ç†ç­‰åŠŸèƒ½ã€‚

### æ ¸å¿ƒåŠŸèƒ½
- **P0 (å¿…é¡»å®ç°)**
  - æ— é™ç”»å¸ƒæ”¯æŒ
  - åŸºç¡€å›¾å½¢ç»˜åˆ¶ï¼ˆçŸ©å½¢ã€åœ†è§’çŸ©å½¢ã€åœ†å½¢ã€ä¸‰è§’å½¢ï¼‰
  - æ–‡æœ¬ç¼–è¾‘ï¼ˆå­—ä½“ã€å¤§å°ã€é¢œè‰²ã€æ ·å¼ï¼‰
  - å›¾ç‰‡ä¸Šä¼ ä¸æ»¤é•œ
  - å…ƒç´ é€‰æ‹©ï¼ˆå•é€‰ã€å¤šé€‰ã€æ¡†é€‰ï¼‰
  - å…ƒç´ æ“ä½œï¼ˆæ‹–æ‹½ã€ç¼©æ”¾ã€æ—‹è½¬ï¼‰
  - å±æ€§é¢æ¿ï¼ˆå®æ—¶ç¼–è¾‘å…ƒç´ å±æ€§ï¼‰
  - å¤åˆ¶/ç²˜è´´/åˆ é™¤
  - æ•°æ®æŒä¹…åŒ–

- **P1 (ä¼˜å…ˆå®ç°)**
  - æ’¤é”€/é‡åš
  - å›¾å±‚ç®¡ç†
  - å¯¹é½è¾…åŠ©çº¿
  - å¿«æ·é”®æ”¯æŒ

- **P2 (åç»­ä¼˜åŒ–)**
  - ååŒç¼–è¾‘
  - å¯¼å‡ºä¸ºå›¾ç‰‡/PDF
  - æ¨¡æ¿åº“
  - ç»„ä»¶å¤ç”¨

### ç›¸å…³äººå‘˜
- å¼€å‘ï¼š@ç©†å¤©å®‡

### ç›¸å…³èµ„æº
- **Git åˆ†æ”¯ï¼š** main
- **é¡¹ç›®è·¯å¾„ï¼š** `C:\Users\34176\Desktop\ç”»å¸ƒ\canvas-editor`
- **åœ¨çº¿é¢„è§ˆï¼š** http://localhost:5173/

---

## 2. æŠ€æœ¯é€‰å‹

### å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | é€‰å‹ | ç‰ˆæœ¬ | é€‰å‹ç†ç”± |
|------|------|------|----------|
| å‰ç«¯æ¡†æ¶ | **React** | 18.3.1 | ç”Ÿæ€æˆç†Ÿï¼Œç»„ä»¶åŒ–å¼€å‘ï¼ŒHooks API çµæ´» |
| è¯­è¨€ | **TypeScript** | 5.6.2 | ç±»å‹å®‰å…¨ï¼Œæå‡ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§ |
| æ„å»ºå·¥å…· | **Vite** | 6.0.1 | å¼€å‘ä½“éªŒå¥½ï¼ŒHMR å¿«é€Ÿï¼Œæ„å»ºé€Ÿåº¦å¿« |
| æ¸²æŸ“å¼•æ“ | **PixiJS** | 8.0.5 | é«˜æ€§èƒ½ WebGL/WebGPU æ¸²æŸ“ï¼Œé€‚åˆå›¾å½¢å¯†é›†åº”ç”¨ |
| çŠ¶æ€ç®¡ç† | **React Hooks** | - | é¡¹ç›®è§„æ¨¡é€‚ä¸­ï¼Œä½¿ç”¨è‡ªå®šä¹‰ Hooks å³å¯æ»¡è¶³éœ€æ±‚ |
| æ ·å¼æ–¹æ¡ˆ | **CSS-in-JS** | - | åŠ¨æ€æ ·å¼ï¼Œç»„ä»¶åŒ–ï¼Œé¿å…å…¨å±€æ±¡æŸ“ |
| AI å·¥å…· | **Claude** | - | ä»£ç ç”Ÿæˆã€é—®é¢˜è¯Šæ–­ã€æ¶æ„è®¾è®¡è¾…åŠ© |

### æŠ€æœ¯é€‰å‹ç†ç”±è¯´æ˜

**ä¸ºä»€ä¹ˆé€‰æ‹© PixiJSï¼Ÿ**
- åŸºäº WebGL/WebGPUï¼Œæ¸²æŸ“æ€§èƒ½ä¼˜ç§€
- æ”¯æŒé«˜ DPI å±å¹•ï¼Œç”»è´¨æ¸…æ™°
- ä¸°å¯Œçš„å›¾å½¢ APIï¼Œæ»¡è¶³å„ç§ç»˜åˆ¶éœ€æ±‚
- ç¤¾åŒºæ´»è·ƒï¼Œæ–‡æ¡£å®Œå–„

**ä¸ºä»€ä¹ˆä¸ç”¨ Canvas 2Dï¼Ÿ**
- Canvas 2D æ€§èƒ½è¾ƒå·®ï¼Œå¤§é‡å…ƒç´ æ—¶ä¼šå¡é¡¿
- ä¸æ”¯æŒç¡¬ä»¶åŠ é€Ÿ
- ç¼ºå°‘é«˜çº§æ¸²æŸ“ç‰¹æ€§ï¼ˆæ»¤é•œã€æ··åˆæ¨¡å¼ç­‰ï¼‰

**ä¸ºä»€ä¹ˆä½¿ç”¨ Hooks è€Œé Reduxï¼Ÿ**
- é¡¹ç›®çŠ¶æ€ç»“æ„ç®€å•ï¼Œä¸éœ€è¦å¤æ‚çš„çŠ¶æ€ç®¡ç†
- Hooks æ›´è½»é‡ï¼Œå‡å°‘æ ·æ¿ä»£ç 
- ç»„ä»¶é—´é€šä¿¡é€šè¿‡ props ä¼ é€’å³å¯

---

## 3. è¯¦ç»†è®¾è®¡

### 3.1 æ•´ä½“æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         åº”ç”¨å±‚ (App.tsx)                      â”‚
â”‚  - å…¨å±€å¸ƒå±€                                                    â”‚
â”‚  - çŠ¶æ€ç®¡ç†å…¥å£                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å·¥å…·æ ç»„ä»¶   â”‚ â”‚  ç”»å¸ƒç»„ä»¶     â”‚ â”‚  å±æ€§é¢æ¿     â”‚
â”‚  Toolbar     â”‚ â”‚  CanvasView  â”‚ â”‚ PropertyPanelâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚        â”‚        â”‚
                â–¼        â–¼        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ é€‰æ‹©æ¡†   â”‚ â”‚ ç¼©æ”¾æŸ„   â”‚ â”‚ æ–‡æœ¬ç¼–è¾‘ â”‚
        â”‚Selection â”‚ â”‚ Resize   â”‚ â”‚  Editor  â”‚
        â”‚   Box    â”‚ â”‚ Handles  â”‚ â”‚          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  æ¸²æŸ“å¼•æ“å±‚       â”‚
                â”‚  PixiRenderer    â”‚
                â”‚  - WebGL æ¸²æŸ“    â”‚
                â”‚  - å…ƒç´ ç®¡ç†       â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   æ•°æ®å±‚         â”‚
                â”‚  useCanvasState  â”‚
                â”‚  - å…ƒç´ æ•°æ®       â”‚
                â”‚  - è§†å£çŠ¶æ€       â”‚
                â”‚  - é€‰æ‹©çŠ¶æ€       â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   æŒä¹…åŒ–å±‚       â”‚
                â”‚  localStorage    â”‚
                â”‚  - è‡ªåŠ¨ä¿å­˜       â”‚
                â”‚  - æ•°æ®éªŒè¯       â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ ¸å¿ƒæ¨¡å—è®¾è®¡

#### 3.2.1 ç±»å‹ç³»ç»Ÿ (`types.ts`)

**å…ƒç´ ç±»å‹å®šä¹‰ï¼š**
```typescript
// åŸºç¡€å…ƒç´ ç±»å‹
enum ElementType {
  RECTANGLE = 'rectangle',
  ROUNDED_RECTANGLE = 'rounded-rectangle',
  CIRCLE = 'circle',
  TRIANGLE = 'triangle',
  TEXT = 'text',
  IMAGE = 'image',
}

// åŸºç¡€å…ƒç´ æ¥å£
interface BaseElement {
  id: string;              // å”¯ä¸€æ ‡è¯†
  type: ElementType;       // å…ƒç´ ç±»å‹
  x: number;              // X åæ ‡
  y: number;              // Y åæ ‡
  width: number;          // å®½åº¦
  height: number;         // é«˜åº¦
  rotation: number;       // æ—‹è½¬è§’åº¦
  zIndex: number;         // å±‚çº§
}

// å½¢çŠ¶å…ƒç´ 
interface ShapeElement extends BaseElement {
  backgroundColor: string;  // å¡«å……è‰²
  borderColor: string;      // è¾¹æ¡†è‰²
  borderWidth: number;      // è¾¹æ¡†å®½åº¦
  cornerRadius?: number;    // åœ†è§’åŠå¾„
}

// æ–‡æœ¬å…ƒç´ 
interface TextElement extends BaseElement {
  content: string;          // æ–‡æœ¬å†…å®¹
  style: {
    fontFamily: string;     // å­—ä½“
    fontSize: number;       // å­—å·
    color: string;          // é¢œè‰²
    bold?: boolean;         // åŠ ç²—
    italic?: boolean;       // æ–œä½“
    underline?: boolean;    // ä¸‹åˆ’çº¿
    strikethrough?: boolean;// åˆ é™¤çº¿
    align?: string;         // å¯¹é½
    backgroundColor?: string;// èƒŒæ™¯è‰²
  };
}

// å›¾ç‰‡å…ƒç´ 
interface ImageElement extends BaseElement {
  src: string;              // å›¾ç‰‡åœ°å€
  filter: ImageFilter;      // æ»¤é•œæ•ˆæœ
}
```

**ç”»å¸ƒçŠ¶æ€ï¼š**
```typescript
interface CanvasState {
  elements: CanvasElement[];          // æ‰€æœ‰å…ƒç´ 
  selectedIds: string[];              // é€‰ä¸­çš„å…ƒç´  ID
  viewport: ViewportState;            // è§†å£çŠ¶æ€
}

interface ViewportState {
  x: number;        // è§†å£ X åç§»
  y: number;        // è§†å£ Y åç§»
  scale: number;    // ç¼©æ”¾æ¯”ä¾‹ (0.1 - 5.0)
}
```

#### 3.2.2 çŠ¶æ€ç®¡ç† (`useCanvasState.ts`)

**æ ¸å¿ƒèŒè´£ï¼š**
- ç®¡ç†ç”»å¸ƒæ‰€æœ‰å…ƒç´ æ•°æ®
- å¤„ç†å…ƒç´  CRUD æ“ä½œ
- ç®¡ç†é€‰æ‹©çŠ¶æ€
- å¤„ç†å¤åˆ¶/ç²˜è´´/åˆ é™¤
- è‡ªåŠ¨ä¿å­˜åˆ° localStorage

**å…³é”®æ–¹æ³•ï¼š**
```typescript
interface CanvasStateHook {
  // æ•°æ®
  elements: CanvasElement[];
  selectedIds: string[];
  viewport: ViewportState;
  
  // å…ƒç´ æ“ä½œ
  addElement: (element: CanvasElement) => void;
  updateElement: (id: string, updates: Partial<CanvasElement>) => void;
  deleteElements: (ids: string[]) => void;
  
  // é€‰æ‹©æ“ä½œ
  selectElements: (ids: string[]) => void;
  clearSelection: () => void;
  
  // è§†å£æ“ä½œ
  updateViewport: (updates: Partial<ViewportState>) => void;
  
  // å‰ªè´´æ¿æ“ä½œ
  copy: () => void;
  paste: () => void;
}
```

**æ·±åº¦åˆå¹¶ç­–ç•¥ï¼š**
- æ–‡æœ¬å…ƒç´ çš„ `style` éœ€è¦æ·±åº¦åˆå¹¶ï¼Œé¿å…è¦†ç›–æœªä¿®æ”¹çš„å±æ€§
- å…¶ä»–å…ƒç´ ä½¿ç”¨æµ…åˆå¹¶å³å¯

#### 3.2.3 æ¸²æŸ“å¼•æ“ (`PixiRenderer.ts`)

**æ ¸å¿ƒèŒè´£ï¼š**
- åˆå§‹åŒ– PixiJS åº”ç”¨
- æ¸²æŸ“å„ç±»å…ƒç´ åˆ° Canvas
- ç®¡ç†æ¸²æŸ“å®¹å™¨å’Œç²¾çµ
- å¤„ç†è§†å£å˜æ¢

**å…³é”®ç‰¹æ€§ï¼š**
- **å¼‚æ­¥åˆå§‹åŒ–ï¼š** PixiJS v8 éœ€è¦ `await app.init()`
- **é«˜ DPI æ”¯æŒï¼š** `autoDensity: true`ï¼Œé€‚é…é«˜æ¸…å±
- **WebGPU ä¼˜å…ˆï¼š** ä¼˜å…ˆä½¿ç”¨ WebGPUï¼Œé™çº§åˆ° WebGL
- **åˆ†å±‚æ¸²æŸ“ï¼š** æ¯ä¸ªå…ƒç´ ç‹¬ç«‹å®¹å™¨ï¼Œä¾¿äºå˜æ¢

**API é€‚é… (PixiJS v8)ï¼š**
```typescript
// âœ… æ­£ç¡®å†™æ³• (v8)
graphics.stroke({ width: 2, color: 0xff0000 });

// âŒ é”™è¯¯å†™æ³• (v7)
graphics.lineStyle(2, 0xff0000);
```

#### 3.2.4 äº¤äº’ç®¡ç† (`CanvasView.tsx`)

**äº¤äº’æ¨¡å¼ï¼š**
```typescript
enum InteractionMode {
  NONE = 'none',           // æ— æ“ä½œ
  PANNING = 'panning',     // æ‹–æ‹½ç”»å¸ƒ (Alt + æ‹–æ‹½)
  SELECTING = 'selecting', // æ¡†é€‰
  DRAGGING = 'dragging',   // æ‹–æ‹½å…ƒç´ 
  RESIZING = 'resizing',   // è°ƒæ•´å¤§å°
}
```

**äº‹ä»¶å¤„ç†æµç¨‹ï¼š**
```
onMouseDown
    â†“
åˆ¤æ–­ç‚¹å‡»ä½ç½®
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‚¹å‡»å…ƒç´       â”‚ ç‚¹å‡»ç©ºç™½      â”‚ ç‚¹å‡»ç¼©æ”¾æŸ„    â”‚
â†“              â†“              â†“
é€‰ä¸­å…ƒç´         å¼€å§‹æ¡†é€‰        å¼€å§‹ç¼©æ”¾
è®¾ç½® DRAGGING   è®¾ç½® SELECTING  è®¾ç½® RESIZING
    â†“              â†“              â†“
onMouseMove     onMouseMove     onMouseMove
    â†“              â†“              â†“
æ‹–æ‹½å…ƒç´         æ›´æ–°æ¡†é€‰æ¡†      æ›´æ–°å…ƒç´ å°ºå¯¸
    â†“              â†“              â†“
onMouseUp       onMouseUp       onMouseUp
    â†“              â†“              â†“
å®Œæˆæ‹–æ‹½        å®Œæˆæ¡†é€‰        å®Œæˆç¼©æ”¾
é‡ç½®çŠ¶æ€        é‡ç½®çŠ¶æ€        é‡ç½®çŠ¶æ€
```

**å…³é”®æŠ€æœ¯ç‚¹ï¼š**
- **æ‹–æ‹½é˜ˆå€¼ï¼š** ç§»åŠ¨è¶…è¿‡ 3px æ‰è§¦å‘æ‹–æ‹½ï¼Œé¿å…è¯¯æ“ä½œ
- **Document ç›‘å¬ï¼š** resize æ—¶ç›‘å¬ document çš„ mousemove/mouseupï¼Œé˜²æ­¢é¼ æ ‡ç§»å‡º canvas å¤±æ•ˆ
- **åæ ‡è½¬æ¢ï¼š** å±å¹•åæ ‡ â†” ç”»å¸ƒåæ ‡çš„åŒå‘è½¬æ¢
- **åŒå‡»ç¼–è¾‘ï¼š** ä½¿ç”¨åŸç”Ÿ `dblclick` äº‹ä»¶ï¼Œå¯é æ€§æ›´é«˜

#### 3.2.5 ç»„ä»¶è®¾è®¡

**ResizeHandles (ç¼©æ”¾æ§åˆ¶æŸ„)ï¼š**
- 8 ä¸ªæ§åˆ¶ç‚¹ï¼š4 è§’ + 4 è¾¹
- è§’ç‚¹æ”¯æŒä¿æŒå®½é«˜æ¯”ï¼ˆé»˜è®¤ï¼‰å’Œè‡ªç”±ç¼©æ”¾ï¼ˆæŒ‰ä½ Shiftï¼‰
- è¾¹ç‚¹ä»…æ”¯æŒå•å‘ç¼©æ”¾
- è§†å£å˜æ¢é€‚é…

**TextEditor (æ–‡æœ¬ç¼–è¾‘å™¨)ï¼š**
- è¦†ç›–å¼ textareaï¼Œæ ·å¼ä¸å…ƒç´ åŒæ­¥
- æ”¯æŒå®æ—¶é¢„è§ˆ
- å¤±ç„¦è‡ªåŠ¨ä¿å­˜
- Esc å–æ¶ˆç¼–è¾‘

**ContextMenu (å³é”®èœå•)ï¼š**
- å¤åˆ¶ (Ctrl+C)
- ç²˜è´´ (Ctrl+V)
- åˆ é™¤ (Delete)
- è‡ªåŠ¨å®šä½ï¼Œé˜²æ­¢æº¢å‡º

**PropertyPanel (å±æ€§é¢æ¿)ï¼š**
- æ ¹æ®é€‰ä¸­å…ƒç´ ç±»å‹æ˜¾ç¤ºä¸åŒå±æ€§
- å®æ—¶ç¼–è¾‘ï¼Œå³æ—¶ç”Ÿæ•ˆ
- æ”¯æŒæ‰¹é‡ä¿®æ”¹ï¼ˆå¤šé€‰æ—¶ï¼‰

#### 3.2.6 æ•°æ®æŒä¹…åŒ– (`storage.ts`)

**å­˜å‚¨ç­–ç•¥ï¼š**
- **è‡ªåŠ¨ä¿å­˜ï¼š** 500ms é˜²æŠ–ï¼Œå‡å°‘å†™å…¥é¢‘ç‡
- **æ•°æ®éªŒè¯ï¼š** åŠ è½½æ—¶éªŒè¯æ•°æ®å®Œæ•´æ€§
  - æ£€æŸ¥å¿…å¡«å­—æ®µ
  - æ–‡æœ¬å…ƒç´ å¿…é¡»æœ‰ `content`
  - åæ ‡ã€å°ºå¯¸å¿…é¡»ä¸ºæ•°å­—
- **é”™è¯¯æ¢å¤ï¼š** æ•°æ®æŸåæ—¶è‡ªåŠ¨æ¸…é™¤ï¼ŒåŠ è½½é»˜è®¤å…ƒç´ 
- **åˆå§‹åŒ–æ ‡å¿—ï¼š** é˜²æ­¢æœªåˆå§‹åŒ–æ—¶ä¿å­˜ç©ºæ•°æ®

**å­˜å‚¨é”®ï¼š**
```typescript
const STORAGE_KEY = 'canvas-editor-state';
```

### 3.3 ç›¸å…³ä¾èµ–

**ç”Ÿäº§ä¾èµ–ï¼š**
```json
{
  "react": "^18.3.1",
  "react-dom": "^18.3.1",
  "pixi.js": "^8.0.5"
}
```

**å¼€å‘ä¾èµ–ï¼š**
```json
{
  "typescript": "~5.6.2",
  "vite": "^6.0.1",
  "@vitejs/plugin-react": "^4.3.4",
  "@types/react": "^18.3.12",
  "@types/react-dom": "^18.3.1"
}
```

### 3.4 æ¥å£è®¾è®¡

**å½“å‰ç‰ˆæœ¬ï¼š** æœ¬åœ°åº”ç”¨ï¼Œæ— åç«¯æ¥å£

**æœªæ¥æ‰©å±•ï¼ˆååŒç¼–è¾‘ï¼‰ï¼š**

#### è·å–ç”»å¸ƒæ•°æ®
- **è¯·æ±‚æ–¹å¼ï¼š** GET
- **è¯·æ±‚è·¯å¾„ï¼š** `/api/canvas/:id`
- **è¯·æ±‚å‚æ•°ï¼š**
  | å‚æ•° | ç±»å‹ | å¿…å¡« | å¤‡æ³¨ |
  |------|------|------|------|
  | id | string | æ˜¯ | ç”»å¸ƒ ID |
- **è¿”å›ç»“æ„ï¼š**
  ```json
  {
    "code": 0,
    "data": {
      "id": "canvas-123",
      "name": "æˆ‘çš„è®¾è®¡",
      "elements": [...],
      "viewport": { "x": 0, "y": 0, "scale": 1 },
      "updatedAt": "2025-11-20T12:00:00Z"
    },
    "message": "success"
  }
  ```

#### ä¿å­˜ç”»å¸ƒæ•°æ®
- **è¯·æ±‚æ–¹å¼ï¼š** POST
- **è¯·æ±‚è·¯å¾„ï¼š** `/api/canvas/:id`
- **è¯·æ±‚å‚æ•°ï¼š**
  ```json
  {
    "elements": [...],
    "viewport": { "x": 0, "y": 0, "scale": 1 }
  }
  ```
- **è¿”å›ç»“æ„ï¼š**
  ```json
  {
    "code": 0,
    "data": {
      "id": "canvas-123",
      "version": 42,
      "updatedAt": "2025-11-20T12:00:00Z"
    },
    "message": "success"
  }
  ```

---

## 4. éœ€æ±‚ä¼°æ—¶

| æ¨¡å— | åŠŸèƒ½ | ä¼°æ—¶ | è´Ÿè´£äºº | çŠ¶æ€ | å¤‡æ³¨ |
|------|------|------|--------|------|------|
| åŸºç¡€æ¶æ„ | é¡¹ç›®æ­å»ºã€ç±»å‹å®šä¹‰ | 0.5pd | @ç©†å¤©å®‡ | âœ… å·²å®Œæˆ | Vite + React + TS |
| æ¸²æŸ“å¼•æ“ | PixiJS é›†æˆä¸å°è£… | 1pd | @ç©†å¤©å®‡ | âœ… å·²å®Œæˆ | åŒ…å« v8 API é€‚é… |
| çŠ¶æ€ç®¡ç† | useCanvasState Hook | 0.5pd | @ç©†å¤©å®‡ | âœ… å·²å®Œæˆ | åŒ…å«æ·±åº¦åˆå¹¶ä¼˜åŒ– |
| ç”»å¸ƒäº¤äº’ | é€‰æ‹©/æ‹–æ‹½/æ¡†é€‰ | 1.5pd | @ç©†å¤©å®‡ | âœ… å·²å®Œæˆ | åŒ…å«æ‹–æ‹½é˜ˆå€¼ |
| ç¼©æ”¾åŠŸèƒ½ | ç¼©æ”¾æ§åˆ¶æŸ„ | 1pd | @ç©†å¤©å®‡ | âœ… å·²å®Œæˆ | 8 æ§åˆ¶ç‚¹ + å®½é«˜æ¯” |
| æ–‡æœ¬ç¼–è¾‘ | åŒå‡»ç¼–è¾‘æ–‡æœ¬ | 0.5pd | @ç©†å¤©å®‡ | âœ… å·²å®Œæˆ | è¦†ç›–å¼ç¼–è¾‘å™¨ |
| å±æ€§é¢æ¿ | å®æ—¶ç¼–è¾‘å±æ€§ | 1pd | @ç©†å¤©å®‡ | âœ… å·²å®Œæˆ | åˆ†ç±»å‹æ˜¾ç¤º |
| å³é”®èœå• | å¤åˆ¶/ç²˜è´´/åˆ é™¤ | 0.5pd | @ç©†å¤©å®‡ | âœ… å·²å®Œæˆ | åŒ…å«å¿«æ·é”® |
| æ•°æ®æŒä¹…åŒ– | localStorage å­˜å‚¨ | 0.5pd | @ç©†å¤©å®‡ | âœ… å·²å®Œæˆ | åŒ…å«æ•°æ®éªŒè¯ |
| Bug ä¿®å¤ | PixiJS v8 å…¼å®¹æ€§ | 1pd | @ç©†å¤©å®‡ | âœ… å·²å®Œæˆ | stroke APIã€è¢«åŠ¨äº‹ä»¶ |
| Bug ä¿®å¤ | é«˜ DPI æ¨¡ç³Šé—®é¢˜ | 0.5pd | @ç©†å¤©å®‡ | âœ… å·²å®Œæˆ | autoDensity é…ç½® |
| Bug ä¿®å¤ | æ–‡æœ¬æ ·å¼æ›´æ–°é—®é¢˜ | 0.5pd | @ç©†å¤©å®‡ | âœ… å·²å®Œæˆ | æ·±åº¦åˆå¹¶ç­–ç•¥ |
| **P0 å°è®¡** | | **9pd** | | **100% å®Œæˆ** | |
| æ’¤é”€/é‡åš | å†å²æ ˆç®¡ç† | 1pd | - | ğŸ”² å¾…å¼€å‘ | P1 åŠŸèƒ½ |
| å›¾å±‚é¢æ¿ | å›¾å±‚åˆ—è¡¨ä¸æ’åº | 1pd | - | ğŸ”² å¾…å¼€å‘ | P1 åŠŸèƒ½ |
| å¯¹é½è¾…åŠ© | æ™ºèƒ½è¾…åŠ©çº¿ | 1.5pd | - | ğŸ”² å¾…å¼€å‘ | P1 åŠŸèƒ½ |
| å¯¼å‡ºåŠŸèƒ½ | PNG/SVG/PDF | 1pd | - | ğŸ”² å¾…å¼€å‘ | P2 åŠŸèƒ½ |

**æ€»è®¡ï¼š** P0 å·²å®Œæˆ 9pdï¼ŒP1/P2 é¢„è®¡ 4.5pd

---

## 5. æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

### 5.1 PixiJS v8 API å˜æ›´

**é—®é¢˜ï¼š** PixiJS v8 æ”¹å˜äº†å¤šä¸ªæ ¸å¿ƒ APIï¼Œæ—§ä»£ç æ— æ³•è¿è¡Œ

**è§£å†³æ–¹æ¡ˆï¼š**
1. **å¼‚æ­¥åˆå§‹åŒ–ï¼š**
   ```typescript
   // v8 éœ€è¦ await
   await app.init({ 
     canvas, 
     autoDensity: true,
     resolution: window.devicePixelRatio 
   });
   ```

2. **Graphics APIï¼š**
   ```typescript
   // æ–° API
   graphics.stroke({ width: 2, color: 0xff0000 });
   
   // æ—§ API (å·²åºŸå¼ƒ)
   // graphics.lineStyle(2, 0xff0000);
   ```

### 5.2 Canvas æ¨¡ç³Šé—®é¢˜

**é—®é¢˜ï¼š** åœ¨é«˜ DPI å±å¹•ä¸Šï¼ŒCanvas å†…å®¹æ¨¡ç³Š

**è§£å†³æ–¹æ¡ˆï¼š**
```typescript
// å¯ç”¨è‡ªåŠ¨å¯†åº¦é€‚é…
autoDensity: true,
resolution: window.devicePixelRatio,

// æ–‡æœ¬å•ç‹¬è®¾ç½®åˆ†è¾¨ç‡
text.resolution = Math.min(devicePixelRatio, 2);
```

### 5.3 æ–‡æœ¬æ ·å¼æ›´æ–°å¤±æ•ˆ

**é—®é¢˜ï¼š** ä¿®æ”¹æ–‡æœ¬é¢œè‰²æˆ–ä¸‹åˆ’çº¿æ—¶ï¼Œå…¶ä»–æ ·å¼è¢«æ¸…ç©º

**æ ¹æœ¬åŸå› ï¼š** ä½¿ç”¨æµ…åˆå¹¶ `{ ...el, ...updates }` å¯¼è‡´ `style` å¯¹è±¡è¢«å®Œå…¨æ›¿æ¢

**è§£å†³æ–¹æ¡ˆï¼š**
```typescript
if (el.type === 'text' && 'style' in updates) {
  return {
    ...textEl,
    ...textUpdates,
    style: { ...textEl.style, ...textUpdates.style }  // æ·±åº¦åˆå¹¶
  };
}
```

### 5.4 è¢«åŠ¨äº‹ä»¶ç›‘å¬å™¨è­¦å‘Š

**é—®é¢˜ï¼š** `Unable to preventDefault inside passive event listener`

**æ ¹æœ¬åŸå› ï¼š** React çš„ `onWheel` é»˜è®¤æ˜¯è¢«åŠ¨ç›‘å¬å™¨ï¼Œæ— æ³•è°ƒç”¨ `preventDefault()`

**è§£å†³æ–¹æ¡ˆï¼š**
```typescript
// ä½¿ç”¨åŸç”Ÿäº‹ä»¶ç›‘å¬å™¨
canvas.addEventListener('wheel', handleWheel, { passive: false });
```

### 5.5 Resize æ§åˆ¶æŸ„å¤±æ•ˆ

**é—®é¢˜ï¼š** æ‹–åŠ¨ ResizeHandles æ—¶ï¼Œé¼ æ ‡ç§»å‡º canvas åæ— æ³•ç»§ç»­è°ƒæ•´

**æ ¹æœ¬åŸå› ï¼š** äº‹ä»¶ç›‘å¬å™¨ç»‘å®šåœ¨ canvas ä¸Šï¼Œé¼ æ ‡ç§»å‡ºåå¤±å»è¿½è¸ª

**è§£å†³æ–¹æ¡ˆï¼š**
```typescript
// åœ¨ document ä¸Šç›‘å¬ mousemove/mouseup
useEffect(() => {
  if (mode === InteractionMode.RESIZING) {
    document.addEventListener('mousemove', handleMouseMove);
    document.addEventListener('mouseup', handleMouseUp);
    return () => {
      document.removeEventListener('mousemove', handleMouseMove);
      document.removeEventListener('mouseup', handleMouseUp);
    };
  }
}, [mode]);
```

### 5.6 localStorage æ•°æ®æŸå

**é—®é¢˜ï¼š** åˆ·æ–°åæœ‰æ—¶æ— æ³•æ­£ç¡®åŠ è½½æ•°æ®ï¼Œæˆ–æ˜¾ç¤ºç©ºç™½

**è§£å†³æ–¹æ¡ˆï¼š**
1. **åŠ è½½æ—¶ä¸¥æ ¼éªŒè¯ï¼š**
   ```typescript
   // éªŒè¯å…ƒç´ å®Œæ•´æ€§
   const isValid = state.elements.every((el: any) => {
     if (!el.id || !el.type) return false;
     if (el.type === 'text' && !el.content) return false;
     if (typeof el.x !== 'number') return false;
     return true;
   });
   ```

2. **åˆå§‹åŒ–æ ‡å¿—ï¼š**
   ```typescript
   // é˜²æ­¢æœªåˆå§‹åŒ–æ—¶ä¿å­˜ç©ºæ•°æ®
   const [initialized, setInitialized] = useState(false);
   useEffect(() => {
     if (!initialized) return;
     debouncedSave({ elements, viewport, selectedIds });
   }, [elements, initialized]);
   ```

3. **è‡ªåŠ¨æ¸…ç†ï¼š**
   ```typescript
   // æ•°æ®æ— æ•ˆæ—¶æ¸…é™¤
   if (!isValid) {
     localStorage.removeItem(STORAGE_KEY);
     return null;
   }
   ```

---

## 6. æ€§èƒ½ä¼˜åŒ–

### 6.1 æ¸²æŸ“ä¼˜åŒ–
- **æŒ‰éœ€é‡ç»˜ï¼š** ä»…åœ¨å…ƒç´ æˆ–è§†å£å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“
- **é˜²æŠ–ä¿å­˜ï¼š** 500ms é˜²æŠ–ï¼Œå‡å°‘ localStorage å†™å…¥
- **åˆ†è¾¨ç‡é™åˆ¶ï¼š** æ–‡æœ¬åˆ†è¾¨ç‡é™åˆ¶ä¸º `Math.min(dpr, 2)`ï¼Œé™ä½å†…å­˜å ç”¨

### 6.2 äº¤äº’ä¼˜åŒ–
- **æ‹–æ‹½é˜ˆå€¼ï¼š** 3px é˜ˆå€¼é˜²æ­¢è¯¯è§¦å‘
- **è™šæ‹Ÿæ»šåŠ¨ï¼š** (æœªæ¥) å›¾å±‚é¢æ¿ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼Œæ”¯æŒå¤§é‡å…ƒç´ 

### 6.3 å†…å­˜ä¼˜åŒ–
- **ç»„ä»¶å¸è½½ï¼š** æ¸…ç† PixiJS èµ„æºï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
  ```typescript
  useEffect(() => {
    return () => {
      if (renderer) {
        renderer.destroy();
      }
    };
  }, []);
  ```

---

## 7. æµ‹è¯•è®¡åˆ’

### 7.1 å•å…ƒæµ‹è¯•
- [ ] å·¥å…·å‡½æ•°æµ‹è¯• (`helpers.ts`)
- [ ] æ•°æ®éªŒè¯æµ‹è¯• (`storage.ts`)
- [ ] åæ ‡è½¬æ¢æµ‹è¯•

### 7.2 é›†æˆæµ‹è¯•
- [ ] å…ƒç´  CRUD æ“ä½œ
- [ ] é€‰æ‹©ä¸æ‹–æ‹½æµç¨‹
- [ ] ç¼©æ”¾ä¸æ—‹è½¬
- [ ] å¤åˆ¶ç²˜è´´åŠŸèƒ½

### 7.3 å…¼å®¹æ€§æµ‹è¯•
- [ ] Chrome (latest)
- [ ] Edge (latest)
- [ ] Firefox (latest)
- [ ] Safari (latest)

### 7.4 æ€§èƒ½æµ‹è¯•
- [ ] 1000+ å…ƒç´ æ¸²æŸ“æ€§èƒ½
- [ ] æ‹–æ‹½æµç•…åº¦
- [ ] ç¼©æ”¾å“åº”é€Ÿåº¦

---

## 8. éƒ¨ç½²æ–¹æ¡ˆ

### 8.1 å¼€å‘ç¯å¢ƒ
```bash
npm install
npm run dev
```

### 8.2 ç”Ÿäº§æ„å»º
```bash
npm run build
```

### 8.3 éƒ¨ç½²å¹³å°
- **é™æ€æ‰˜ç®¡ï¼š** Vercel / Netlify / GitHub Pages
- **CDN åŠ é€Ÿï¼š** Cloudflare
- **åŸŸåï¼š** (å¾…å®š)

---

## 9. å‚è€ƒæ–‡æ¡£

### å®˜æ–¹æ–‡æ¡£
- [React å®˜æ–¹æ–‡æ¡£](https://react.dev/)
- [TypeScript å®˜æ–¹æ–‡æ¡£](https://www.typescriptlang.org/)
- [PixiJS å®˜æ–¹æ–‡æ¡£](https://pixijs.com/)
- [Vite å®˜æ–¹æ–‡æ¡£](https://vitejs.dev/)

### è®¾è®¡å‚è€ƒ
- [Figma](https://www.figma.com/)
- [Canva](https://www.canva.com/)
- [Excalidraw](https://excalidraw.com/)

### æŠ€æœ¯æ–‡ç« 
- [PixiJS v8 è¿ç§»æŒ‡å—](https://pixijs.com/8.x/guides/migrations/v8)
- [React 18 å¹¶å‘ç‰¹æ€§](https://react.dev/blog/2022/03/29/react-v18)
- [Canvas é«˜æ¸…å±é€‚é…](https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Optimizing_canvas)

### ç›¸å…³é¡¹ç›®
- [tldraw](https://github.com/tldraw/tldraw) - å¼€æºç™½æ¿å·¥å…·
- [fabric.js](https://github.com/fabricjs/fabric.js) - Canvas å¯¹è±¡åº“
- [Konva](https://github.com/konvajs/konva) - 2D Canvas æ¡†æ¶

---

## 10. åç»­è§„åˆ’

### çŸ­æœŸç›®æ ‡ (1-2 å‘¨)
- [ ] å®ç°æ’¤é”€/é‡åšåŠŸèƒ½
- [ ] æ·»åŠ å¿«æ·é”®æ”¯æŒ
- [ ] ä¼˜åŒ–æ€§èƒ½ï¼ˆè™šæ‹Ÿæ¸²æŸ“ï¼‰

### ä¸­æœŸç›®æ ‡ (1 ä¸ªæœˆ)
- [ ] å›¾å±‚é¢æ¿
- [ ] å¯¹é½è¾…åŠ©çº¿
- [ ] å¯¼å‡ºä¸ºå›¾ç‰‡

### é•¿æœŸç›®æ ‡ (3 ä¸ªæœˆ)
- [ ] ååŒç¼–è¾‘ï¼ˆWebSocketï¼‰
- [ ] æ¨¡æ¿åº“
- [ ] æ’ä»¶ç³»ç»Ÿ

---

## é™„å½•

### A. ç›®å½•ç»“æ„
```
canvas-editor/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/          # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ CanvasView.tsx   # ä¸»ç”»å¸ƒ
â”‚   â”‚   â”œâ”€â”€ Toolbar.tsx      # å·¥å…·æ 
â”‚   â”‚   â”œâ”€â”€ PropertyPanel.tsx # å±æ€§é¢æ¿
â”‚   â”‚   â”œâ”€â”€ ResizeHandles.tsx # ç¼©æ”¾æ§åˆ¶æŸ„
â”‚   â”‚   â”œâ”€â”€ TextEditor.tsx    # æ–‡æœ¬ç¼–è¾‘å™¨
â”‚   â”‚   â””â”€â”€ ContextMenu.tsx   # å³é”®èœå•
â”‚   â”œâ”€â”€ hooks/               # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â””â”€â”€ useCanvasState.ts # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ renderer/            # æ¸²æŸ“å¼•æ“
â”‚   â”‚   â””â”€â”€ PixiRenderer.ts   # PixiJS å°è£…
â”‚   â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ helpers.ts        # é€šç”¨å·¥å…·
â”‚   â”‚   â””â”€â”€ storage.ts        # æ•°æ®æŒä¹…åŒ–
â”‚   â”œâ”€â”€ types.ts             # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ App.tsx              # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ main.tsx             # æ¸²æŸ“å…¥å£
â”œâ”€â”€ public/                  # é™æ€èµ„æº
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vite.config.ts
â””â”€â”€ DESIGN.md               # æœ¬æ–‡æ¡£
```

### B. å¿«æ·é”®åˆ—è¡¨

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| Ctrl/Cmd + C | å¤åˆ¶ |
| Ctrl/Cmd + V | ç²˜è´´ |
| Delete | åˆ é™¤ |
| Ctrl/Cmd + A | å…¨é€‰ |
| Esc | å–æ¶ˆé€‰æ‹© |
| Alt + æ‹–æ‹½ | æ‹–æ‹½ç”»å¸ƒ |
| æ»šè½® | ç¼©æ”¾ç”»å¸ƒ |
| Shift + æ‹–æ‹½æ§åˆ¶ç‚¹ | è‡ªç”±ç¼©æ”¾ï¼ˆä¸ä¿æŒå®½é«˜æ¯”ï¼‰ |
| åŒå‡»æ–‡æœ¬ | ç¼–è¾‘æ–‡æœ¬ |

### C. æµè§ˆå™¨å…¼å®¹æ€§

| æµè§ˆå™¨ | æœ€ä½ç‰ˆæœ¬ | WebGL | WebGPU | å¤‡æ³¨ |
|--------|----------|-------|--------|------|
| Chrome | 90+ | âœ… | âœ… | æ¨è |
| Edge | 90+ | âœ… | âœ… | æ¨è |
| Firefox | 88+ | âœ… | âš ï¸ | WebGPU å®éªŒæ€§ |
| Safari | 14+ | âœ… | âŒ | æ—  WebGPU |

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2025å¹´11æœˆ20æ—¥  
**ç»´æŠ¤è€…ï¼š** @ç©†å¤©å®‡
